# Documenta칞칚o da API - Projeto Destino

Este documento descreve os endpoints da API para o "Projeto Destino", detalhando as rotas de autentica칞칚o e as rotas de teste protegidas.

# 游 Configurando HTTPS Local no Spring Boot com JDK (keytool)

Este guia detalha como gerar um certificado autoassinado usando o `keytool` do JDK, configurar sua aplica칞칚o Spring Boot para usar HTTPS e instalar o certificado no Windows para remover os avisos de seguran칞a do navegador (Chrome, Edge, etc.).

## 1. Pr칠-requisitos

* **Java Development Kit (JDK):** O `keytool` faz parte do JDK.
* **Vari치vel PATH:** Para executar o `keytool` diretamente, certifique-se de que o diret칩rio `bin` do seu JDK (`C:\Program Files\Java\jdk-<vers칚o>\bin`) esteja adicionado  vari치vel de ambiente **`PATH`** do Windows.

## 2. Gera칞칚o do Certificado (`keystore.p12`)

Navegue at칠 o diret칩rio `src/main/resources` do seu projeto Spring Boot e execute o comando abaixo. Ele gera um par de chaves e o armazena no arquivo `keystore.p12`.

O comando 칠 totalmente **n칚o interativo** e inclui o crucial **`Subject Alternative Name (SAN)`** para compatibilidade com navegadores modernos.

# Execute no diret칩rio src/main/resources
- Esse comando cria o certificado, depois 칠 so clicar nele e seguir as instru칞칫es s칩 lembre de colocar no reposit칩rio "Autoridades de Certifica칞칚o Raiz Confi치veis"
- **Importante:** Substitua `minha_senha_segura` por uma senha forte de sua escolha.
> keytool -genkeypair -alias springboot -keyalg RSA -keysize 2048 -dname "CN=localhost, OU=TI, O=MinhaEmpresa, L=SaoPaulo, ST=SP, C=BR" -storetype PKCS12 -keystore keystore.p12 -storepass minha_senha_segura -keypass minha_senha_segura -validity 3650 -ext "SAN=dns:localhost,ip:127.0.0.1,ip:::1"

## Informa칞칫es Gerais

### Autentica칞칚o

A autentica칞칚o 칠 baseada em JSON Web Tokens (JWT).

1.  O usu치rio se registra (se for novo) ou faz login.
2.  O endpoint de login (`/api/auth/login`) retorna um seta um cookie.
3.  Para acessar rotas protegidas, o front-end deve enviar cookie que possui o jwt no cabe칞alho de cada requisi칞칚o.

### URL Base

Todas as rotas s칚o relativas a uma URL base (ex: `http://localhost:8080`).

---

## 1. Endpoints de Autentica칞칚o

Controlador: `AuthController.java`
Caminho Base: `/api/auth`

### 1.1. Registrar Novo Usu치rio

Cria um novo usu치rio no sistema.

- **Endpoint:** `POST /api/auth/r/singup`
- **Descri칞칚o:** Cadastra um novo usu치rio com o perfil padr칚o (`USUARIO`).
- **Corpo da Requisi칞칚o (Request Body):** `(application/json)`

  ```json
  {
    "nome": "string",
    "cpf": "string",
    "email": "string (example@domain.com)",
    "telefone": "string",
    "senha": "string"
  }
  ```

- **Resposta de Sucesso (201 CREATED):**

  ```json
  {
    "error": false,
    "msg": "Usu치rio cadastrado com sucesso!"
  }
  ```

- **Respostas de Erro (400 BAD_REQUEST / 409 CONFLICT):**
  - Se a senha for inv치lida:
    ```json
    {
      "error": true,
      "msg": "A senha n칚o atende aos requisitos de seguran칞a..."
    }
    ```
  - Se o CPF ou E-mail j치 existir:
    ```json
    {
      "error": true,
      "msg": "Erro: usu치rio j치 existe!"
    }
    ```
    ou
    ```json
    {
      "error": true,
      "msg": "Erro: Email j치 est치 em uso"
    }
    ```

### 1.2. Autenticar (Login)

Autentica um usu치rio existente e retorna um token JWT.

- **Endpoint:** `POST /api/auth/login`
- **Descri칞칚o:** Valida as credenciais do usu치rio.
- **Corpo da Requisi칞칚o (Request Body):** `(application/json)`

  ```json
  {
    "email": "string",
    "senha": "string"
  }
  ```

- **Resposta de Sucesso (200 OK):**

  ```json
  {
    "error": false,
    "message": "Login realizado com sucesso.",
    "userInfo": {
      "id": "UUID",
      "name": "Nome do usu치ro"
    }
  }
  ```

- **Resposta de Erro (401/403 UNAUTHORIZED):**
  - (Tratado pelo Spring Security, geralmente retorna um status 401 ou 403 sem corpo espec칤fico se as credenciais estiverem erradas).

---

### 1.3. Buscar usu치rios inv치lidos

Busca por usu치rios que ainda n칚o foram validados.

- **Endpoint:** `Get /api/auth/usuarios/invalidos`
- **Descri칞칚o:** Busca os usu치rios que est칚o com o campo valido = false.
- **Resposta de Sucesso (200 OK):** Devolve uma lista de todos os usu치rios que atendem a condi칞칚o

### 1.4. Autenticar (Login)

Authentica o usu치rio.

- **Endpoint:** `Patch /api/auth/usuarios/validar/{id}`
- **Descri칞칚o:** altera a coluna de v치lido do usu치rio para true atrav칠s do id que 칠 passo pela URL.
- **Resposta de Sucesso (200 OK):** Usu치rio atualizado com sucesso!
- **Resposta de Erro (401/403 UNAUTHORIZED):** N칚o existe usuario com id: " + id

---

### 1.5 Logout
Limpa os cookies do usu치rio

- **Endpoint:** `Patch /api/auth/usuarios/logout`
- **Resposta de Sucesso (200 OK):** Logout realizado!
- 
## 2. Endpoints de Teste (Protegidos)

Controlador: `TestController.java`
Caminho Base: `/api`

### 2.1. Rota P칰blica

Rota acess칤vel sem autentica칞칚o.

- **Endpoint:** `GET /api/publico`
- **Autentica칞칚o:** Nenhuma.
- **Resposta (Texto Simples):**
  `"Ol치! Esta 칠 uma rota p칰blica."`

### 2.2. Rota Privada (Usu치rio)

Rota acess칤vel por usu치rios com o perfil `ROLE_USUARIO`.

- **Endpoint:** `GET /api/privado/usuario`
- **Autentica칞칚o:** Obrigat칩ria (Bearer Token).
- **Perfil Necess치rio:** `ROLE_USUARIO`
- **Resposta (Texto Simples):**
  `"Essa rota s칩 usu치rio, funcion치rio e administrador tem acesso"`

### 2.3. Rota Privada (Funcion치rio)

Rota acess칤vel por usu치rios com o perfil `ROLE_FUNCIONARIO`.

- **Endpoint:** `GET /api/privado/funcionario`
- **Autentica칞칚o:** Obrigat칩ria (Bearer Token).
- **Perfil Necess치rio:** `ROLE_FUNCIONARIO`
- **Resposta (Texto Simples):**
  `"Informa칞칚o Secreta. Voc칡 acessou com um token de 'funcion치rio' ou 'adm' v치lido!"`

### 2.4. Rota Privada (Administrador)

Rota acess칤vel por usu치rios com o perfil `ROLE_ADMINISTRADOR`.

- **Endpoint:** `GET /api/privado/admin`
- **Autentica칞칚o:** Obrigat칩ria (Bearer Token).
- **Perfil Necess치rio:** `ROLE_ADMINISTRADOR`
- **Resposta (Texto Simples):**
  `"Dados Ultra Secretos. Acesso concedido apenas para administradores!"`
